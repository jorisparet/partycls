<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>1. Manipulating a trajectory &mdash; partycls 2.0.1 documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/copybutton.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/sphinx_highlight.js"></script>
        <script src="../../_static/clipboard.min.js"></script>
        <script src="../../_static/copybutton.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
        <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="author" title="About these documents" href="../../about.html" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="2. Setting and running a workflow" href="2_workflow.html" />
    <link rel="prev" title="Tutorials" href="../../tutorials.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html">
            <img src="../../_static/logo.svg" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                2.0.1
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../index.html">Home</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../install.html">Installation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../tutorials.html">Tutorials</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../tutorials.html"> Home</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../../tutorials.html#detailed-examples">Detailed examples</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">1. Manipulating a trajectory</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#Reading-a-trajectory">1.1. Reading a trajectory</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Dealing-with-various-trajectory-formats">1.2. Dealing with various trajectory formats</a></li>
<li class="toctree-l4"><a class="reference internal" href="#System-properties">1.3. System properties</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Particle-properties">1.4. Particle properties</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Reading-additional-particle-properties-from-a-trajectory">1.5. Reading additional particle properties from a trajectory</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Setting-or-modifying-a-particle-property">1.6. Setting or modifying a particle property</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Computing-nearest-neighbors">1.7. Computing nearest neighbors</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Visualizing-a-trajectory">1.8. Visualizing a trajectory</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Writing-a-trajectory">1.9. Writing a trajectory</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="2_workflow.html">2. Setting and running a workflow</a></li>
<li class="toctree-l3"><a class="reference internal" href="3_descriptors.html">3. Setting and computing descriptors</a></li>
<li class="toctree-l3"><a class="reference internal" href="4_going_further.html">4. More advanced applications</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../tutorials.html#structural-descriptors">Structural descriptors</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../api.html">API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../support.html">Support and contribution</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../citing.html">Citing partycls</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../changelog.html">Changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../about.html">About</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">partycls</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a></li>
          <li class="breadcrumb-item"><a href="../../tutorials.html">Tutorials</a></li>
      <li class="breadcrumb-item active"><span class="section-number">1. </span>Manipulating a trajectory</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/jorisparet/partycls/edit/master/docs/tutorials/notebooks/1_trajectory.ipynb" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars and line breaks on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
    white-space: pre;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt .copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
.jp-RenderedHTMLCommon table,
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
.jp-RenderedHTMLCommon thead,
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
.jp-RenderedHTMLCommon tr,
.jp-RenderedHTMLCommon th,
.jp-RenderedHTMLCommon td,
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
.jp-RenderedHTMLCommon th,
div.rendered_html th {
  font-weight: bold;
}
.jp-RenderedHTMLCommon tbody tr:nth-child(odd),
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
.jp-RenderedHTMLCommon tbody tr:hover,
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Run this notebook online: <a class="reference external" href="https://mybinder.org/v2/gh/jorisparet/partycls/master?labpath=docs/tutorials/notebooks/1_trajectory.ipynb"><img alt="Binder badge" src="https://mybinder.org/badge_logo.svg" /></a>. Note that the set up can take a while, as all the dependencies must be installed first.</p>
</div>
<section id="Manipulating-a-trajectory">
<h1><span class="section-number">1. </span>Manipulating a trajectory<a class="headerlink" href="#Manipulating-a-trajectory" title="Permalink to this heading"></a></h1>
<p>This notebook shows how to read and manipulate the trajectories in which the system’s configurations are stored.</p>
<p>In particular, we discuss the reading/writing of input trajectory files using the built-in parsers and third-party packages. We also discuss particle properties and visualization features.</p>
<section id="Reading-a-trajectory">
<h2><span class="section-number">1.1. </span>Reading a trajectory<a class="headerlink" href="#Reading-a-trajectory" title="Permalink to this heading"></a></h2>
<p>A trajectory file can be read using the <code class="docutils literal notranslate"><span class="pre">Trajectory</span></code> class. Let us open our first trajectory file:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>from partycls import Trajectory

traj = Trajectory(&#39;data/kalj_N150.xyz&#39;)
</pre></div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">Trajectory</span></code> instances are <strong>iterable</strong> and composed of <code class="docutils literal notranslate"><span class="pre">System</span></code> instances (<em>i.e.</em> trajectory frames):</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># Number of frames in the trajectory
print(&quot;Number of frames:&quot;, len(traj))
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Number of frames: 101
</pre></div></div>
</div>
<p>Upon reading a trajectory file, several optional parameters can be specified to read only a subset of the available frames:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">first</span></code> is the index of the first frame to read (default is <code class="docutils literal notranslate"><span class="pre">0</span></code>).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">last</span></code> is the index of the last frame to read (default is <code class="docutils literal notranslate"><span class="pre">None</span></code>, meaning it will read up to the last frame).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">step</span></code> is the increment between two consecutive frames to read (default is <code class="docutils literal notranslate"><span class="pre">1</span></code>, meaning that every frame is read). For instance, <code class="docutils literal notranslate"><span class="pre">step=2</span></code> means that every 2 frames only will be read.</p></li>
</ul>
<p>Example:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># Read the 10 first frames only
traj = Trajectory(&#39;data/kalj_N150.xyz&#39;, first=0, last=9)
print(&quot;Number of frames:&quot;, len(traj))
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Number of frames: 10
</pre></div></div>
</div>
<p>Now, let us have a look at the first frame of this trajectory, which is an instance of <code class="docutils literal notranslate"><span class="pre">System</span></code>:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>print(traj[0])
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
System(number_of_particles=150, species=[&#39;A&#39; &#39;B&#39;], chemical_fractions=[0.8 0.2], cell=[5. 5. 5.])
</pre></div></div>
</div>
<p>This tells us about the main features of the system: number of particles, chemical species, etc. In particular, a <code class="docutils literal notranslate"><span class="pre">System</span></code> is enclosed in an orthorhombic simulation cell , which is an instance of <code class="docutils literal notranslate"><span class="pre">Cell</span></code>.</p>
<p>A cell is characterized by the sizes of its sides and by whether it uses periodic boundary conditions (which are assumed by default):</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>print(traj[0].cell)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Cell(side=[5. 5. 5.], periodic=[ True  True  True], volume=125.0)
</pre></div></div>
</div>
<p>Cell properties can be accessed as instances attributes:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>cell = traj[0].cell

print(&quot;Sides:&quot;, cell.side)
print(&quot;Periodicity:&quot;, cell.periodic)
print(&quot;Volume:&quot;, cell.volume)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Sides: [5. 5. 5.]
Periodicity: [ True  True  True]
Volume: 125.0
</pre></div></div>
</div>
<p><em>partycls</em> accepts both 2- and 3-dimensional systems. The spatial dimension is guessed from the number of sides the cell has in the input file:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># Dimension
print(&quot;Spatial dimension:&quot;, traj[0].n_dimensions)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Spatial dimension: 3
</pre></div></div>
</div>
<p>A <code class="docutils literal notranslate"><span class="pre">System</span></code> is composed of a collection of particles, which are <code class="docutils literal notranslate"><span class="pre">Particle</span></code> instances. Particles can be accessed from a system via its iterable <code class="docutils literal notranslate"><span class="pre">particle</span></code> attribute:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># First two particles in the system
print(traj[0].particle[0])
print(traj[0].particle[1])
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Particle(position=[ 0.819926 -1.760086  0.36845 ], species=A, label=-1, radius=0.5, nearest_neighbors=None, species_id=1)
Particle(position=[ 0.29098   1.24579  -2.495344], species=A, label=-1, radius=0.5, nearest_neighbors=None, species_id=1)
</pre></div></div>
</div>
<p>Particle properties will be discussed in a further section.</p>
</section>
<section id="Dealing-with-various-trajectory-formats">
<h2><span class="section-number">1.2. </span>Dealing with various trajectory formats<a class="headerlink" href="#Dealing-with-various-trajectory-formats" title="Permalink to this heading"></a></h2>
<p>Natively, the code only reads/writes standard <a class="reference external" href="https://en.wikipedia.org/wiki/XYZ_file_format">XYZ</a> trajectories (with a mandatory <code class="docutils literal notranslate"><span class="pre">cell</span></code> attribute in the comment line) and <a class="reference external" href="http://rumd.org/">RUMD</a> trajectories:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># Open a XYZ trajectory
#  default value for `fmt` is &quot;xyz&quot;
traj_xyz = Trajectory(&#39;data/kalj_N150.xyz&#39;,
                      fmt=&#39;xyz&#39;)
print(traj_xyz)

# Open a RUMD trajectory
traj_rumd = Trajectory(&#39;data/kalj_N256_rho1.185_rumd.xyz.gz&#39;,
                       fmt=&#39;rumd&#39;)
print(traj_rumd)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Trajectory(filename=&#34;data/kalj_N150.xyz&#34;, number_of_frames=101)
Trajectory(filename=&#34;data/kalj_N256_rho1.185_rumd.xyz.gz&#34;, number_of_frames=1)
</pre></div></div>
</div>
<p>However, it is possible to rely on external packages to read more formats such as <a class="reference external" href="https://lammps.sandia.gov/">LAMMPS</a>, <a class="reference external" href="https://www.gromacs.org/">GROMACS</a>, etc. or even your custom trajectory formats.</p>
<p>These two external packages are:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://framagit.org/atooms/atooms">atooms</a> - a Python framework for simulations of interacting particles.</p></li>
<li><p><a class="reference external" href="https://www.mdtraj.org/1.9.5/index.html">MDTraj</a> - a Python library that allows users to manipulate molecular dynamics trajectories.</p></li>
</ul>
<p>With these dependencies properly installed in the Python environment, it is possible to use them as backend when creating an instance of <code class="docutils literal notranslate"><span class="pre">Trajectory</span></code>:</p>
<section id="Atooms">
<h3><span class="section-number">1.2.1. </span>Atooms<a class="headerlink" href="#Atooms" title="Permalink to this heading"></a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># Open a LAMMPS trajectory using atooms
traj = Trajectory(&#39;data/lj_N256_rho1.0.atom&#39;,
                  fmt=&#39;lammps&#39;,
                  backend=&#39;atooms&#39;)

print(&#39;Number of frames:&#39;, len(traj))
print(traj[0])
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Number of frames: 6
System(number_of_particles=256, species=[&#39;1&#39;], chemical_fractions=[1.], cell=[6.3496 6.3496 6.3496])
</pre></div></div>
</div>
<p>When using <code class="docutils literal notranslate"><span class="pre">backend=&quot;atooms&quot;</span></code>, the <code class="docutils literal notranslate"><span class="pre">fmt</span></code> parameter must be set to the right trajectory format to select the appropriate parser. This is indepedent of the file extension.</p>
</section>
<section id="MDTraj">
<h3><span class="section-number">1.2.2. </span>MDTraj<a class="headerlink" href="#MDTraj" title="Permalink to this heading"></a></h3>
<p>When using <code class="docutils literal notranslate"><span class="pre">backend=&quot;mdtraj&quot;</span></code>, however, the file extension is used to determine the correct format (the <code class="docutils literal notranslate"><span class="pre">fmt</span></code> parameter can thus be ignored).</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># Open a PDB trajectory using MDTraj
traj = Trajectory(&#39;data/frame0.pdb&#39;,
                  backend=&#39;mdtraj&#39;)

print(&#39;Number of frames:&#39;, len(traj))
print(traj[0])
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Number of frames: 501
System(number_of_particles=22, species=[&#39;C&#39; &#39;H&#39; &#39;N&#39; &#39;O&#39;], chemical_fractions=[0.27272727 0.54545455 0.09090909 0.09090909], cell=[1. 1. 1.])
</pre></div></div>
</div>
<p>An additional <code class="docutils literal notranslate"><span class="pre">top</span></code> parameter can be specified for trajectory files that require external topology information (see <a class="reference external" href="https://www.mdtraj.org/">MDTraj</a> documentation). This parameter is specific to <em>MDTraj</em> and will be ignored when using atooms or native formats.</p>
</section>
</section>
<section id="System-properties">
<h2><span class="section-number">1.3. </span>System properties<a class="headerlink" href="#System-properties" title="Permalink to this heading"></a></h2>
<p>Now that we know how to properly read a trajectory file and how <code class="docutils literal notranslate"><span class="pre">Trajectory</span></code> instances are structured, let us look at some general properties of <code class="docutils literal notranslate"><span class="pre">System</span></code> instances:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>traj = Trajectory(&#39;data/kalj_N150.xyz&#39;, last=0)
sys = traj[0]

print(&#39;Number of spatial dimensions :&#39;, sys.n_dimensions)
print(&#39;Number of particles :&#39;, len(sys.particle))
print(&#39;Density :&#39;, sys.density)
print(&#39;Distinct species :&#39;, sys.distinct_species)
print(&#39;Chemical fractions :&#39;, sys.chemical_fractions)
print(&#39;Pairs of species :&#39;, sys.pairs_of_species)
print(&#39;Pairs of species ID :&#39;, sys.pairs_of_species_id)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Number of spatial dimensions : 3
Number of particles : 150
Density : 1.2
Distinct species : [&#39;A&#39; &#39;B&#39;]
Chemical fractions : [0.8 0.2]
Pairs of species : [(&#39;A&#39;, &#39;A&#39;), (&#39;A&#39;, &#39;B&#39;), (&#39;B&#39;, &#39;A&#39;), (&#39;B&#39;, &#39;B&#39;)]
Pairs of species ID : [(1, 1), (1, 2), (2, 1), (2, 2)]
</pre></div></div>
</div>
<p>The very last property, <code class="docutils literal notranslate"><span class="pre">pairs_of_species_id</span></code>, allows us to standardize the species in the trajectory, from a literal name or symbol to an integer value. Here, for example, we have:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;A&quot;</span></code> → <code class="docutils literal notranslate"><span class="pre">1</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;B&quot;</span></code> → <code class="docutils literal notranslate"><span class="pre">2</span></code></p></li>
</ul>
<p>In more complex cases, for instance when dealing with atomic symbols such as <code class="docutils literal notranslate"><span class="pre">&quot;Si&quot;</span></code>, <code class="docutils literal notranslate"><span class="pre">&quot;C&quot;</span></code>, <code class="docutils literal notranslate"><span class="pre">&quot;O&quot;</span></code>, etc., this standardization can come in handy.</p>
</section>
<section id="Particle-properties">
<h2><span class="section-number">1.4. </span>Particle properties<a class="headerlink" href="#Particle-properties" title="Permalink to this heading"></a></h2>
<p>In a previous section, we saw that <code class="docutils literal notranslate"><span class="pre">Particle</span></code> instances are characterized by an ensemble of properties such as their position, their chemical species, etc. These properties can easily be accessed and manipulated.</p>
<p>In particular, particles are characterized by:</p>
<ul class="simple">
<li><p>A position vector.</p></li>
<li><p>A species (chemical symbol or type).</p></li>
<li><p>A radius (set to <code class="docutils literal notranslate"><span class="pre">0.5</span></code> by default).</p></li>
<li><p>A label, which is the index of the cluster that particle belongs to. Its default value is <code class="docutils literal notranslate"><span class="pre">-1</span></code> but it is automatically assigned after a clustering is performed, as we will see in the <a class="reference external" href="2_workflow.html">next notebook</a>.</p></li>
<li><p>A list of nearest neighbors (<code class="docutils literal notranslate"><span class="pre">None</span></code> by default).</p></li>
<li><p>And more.</p></li>
</ul>
<p>Such properties can be accessed as instances attributes:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># Isolate the first particle in the trajectory
traj = Trajectory(&#39;data/kalj_N150.xyz&#39;, last=9)
p = traj[0].particle[0]

# Some properties
print(&#39;Position:&#39;, p.position)
print(&#39;Species:&#39;, p.species)
print(&#39;Radius:&#39;, p.radius)
print(&#39;Label:&#39;, p.label)
print(&#39;Neighbors:&#39;, p.nearest_neighbors)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Position: [ 0.819926 -1.760086  0.36845 ]
Species: A
Radius: 0.5
Label: -1
Neighbors: None
</pre></div></div>
</div>
<p>An arbitrary property can also be assigned to a particle:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>print(&quot;Before:\n&quot;, p)

# Set a mass
p.mass = 0.5
print(&quot;\nAfter:\n&quot;, p)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Before:
 Particle(position=[ 0.819926 -1.760086  0.36845 ], species=A, label=-1, radius=0.5, nearest_neighbors=None, species_id=1)

After:
 Particle(position=[ 0.819926 -1.760086  0.36845 ], species=A, label=-1, radius=0.5, nearest_neighbors=None, species_id=1, mass=0.5)
</pre></div></div>
</div>
<p>A more practical way to access particle properties is via the method <code class="docutils literal notranslate"><span class="pre">get_property()</span></code> (also called <code class="docutils literal notranslate"><span class="pre">dump()</span></code> for short), either from <code class="docutils literal notranslate"><span class="pre">System</span></code> or from <code class="docutils literal notranslate"><span class="pre">Trajectory</span></code> :</p>
<ol class="arabic simple">
<li><p>For a <code class="docutils literal notranslate"><span class="pre">System</span></code>, this will return a <code class="docutils literal notranslate"><span class="pre">numpy.ndarray</span></code>:</p></li>
</ol>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># Positions of all the particles in the first frame
pos_0 = traj[0].get_property(&#39;position&#39;)
print(&quot;\nType:&quot;, type(pos_0), &quot;\n&quot;)

# Show the positions of the 5 first particles
print(pos_0[0:5])
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

Type: &lt;class &#39;numpy.ndarray&#39;&gt;

[[0.819926 -1.760086 0.36845]
 [0.29098 1.24579 -2.495344]
 [2.484607 0.35245 1.371003]
 [-1.02062 -1.927986 0.663132]
 [-0.816276 2.062004 0.421107]]
</pre></div></div>
</div>
<ol class="arabic simple" start="2">
<li><p>For a <code class="docutils literal notranslate"><span class="pre">Trajectory</span></code>, this will return a list of <code class="docutils literal notranslate"><span class="pre">numpy.ndarray</span></code> with length <code class="docutils literal notranslate"><span class="pre">len(traj)</span></code>:</p></li>
</ol>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># Positions of all the particles in the trajectory
all_pos = traj.get_property(&#39;position&#39;)
print(&quot;Type:&quot;, type(all_pos))

# `all_pos` should have length 10
print(&quot;\nNumber of frames:&quot;, len(all_pos), &quot;\n&quot;)

# Positions in the first frame is the first element of the dumped list
# It must be identical to the previous cell
print(all_pos[0][0:5])
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Type: &lt;class &#39;list&#39;&gt;

Number of frames: 10

[[0.819926 -1.760086 0.36845]
 [0.29098 1.24579 -2.495344]
 [2.484607 0.35245 1.371003]
 [-1.02062 -1.927986 0.663132]
 [-0.816276 2.062004 0.421107]]
</pre></div></div>
</div>
<p>This method accepts aliases for common particle properties, such as the position of the species:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># Use &quot;dump&quot; instead of &quot;get_property&quot; (equivalent)
pos_0 = traj[0].dump(&#39;pos&#39;)
x_0 = traj[0].dump(&#39;x&#39;) # x position only
spe_0 = traj[0].dump(&#39;spe&#39;)

print(&quot;Positions:\n&quot;, pos_0[0:5])
print(&quot;\nPositions (x):\n&quot;, x_0[0:5])
print(&quot;\nSpecies:\n&quot;, spe_0[0:5])
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Positions:
 [[0.819926 -1.760086 0.36845]
 [0.29098 1.24579 -2.495344]
 [2.484607 0.35245 1.371003]
 [-1.02062 -1.927986 0.663132]
 [-0.816276 2.062004 0.421107]]

Positions (x):
 [0.819926 0.29098 2.484607 -1.02062 -0.816276]

Species:
 [&#39;A&#39; &#39;A&#39; &#39;A&#39; &#39;A&#39; &#39;A&#39;]
</pre></div></div>
</div>
<p>The list of available aliases can be found in the <code class="docutils literal notranslate"><span class="pre">particle_aliases</span></code> dictionary:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>from partycls import particle_aliases

print(&quot;Available aliases:&quot;)
for alias, prop in particle_aliases.items():
    print(f&#39;- &quot;{alias}&quot;: &quot;{prop}&quot;&#39;)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Available aliases:
- &#34;position&#34;: &#34;particle.position&#34;
- &#34;pos&#34;: &#34;particle.position&#34;
- &#34;position[0]&#34;: &#34;particle.position[0]&#34;
- &#34;pos[0]&#34;: &#34;particle.position[0]&#34;
- &#34;x&#34;: &#34;particle.position[0]&#34;
- &#34;position[1]&#34;: &#34;particle.position[1]&#34;
- &#34;pos[1]&#34;: &#34;particle.position[1]&#34;
- &#34;y&#34;: &#34;particle.position[1]&#34;
- &#34;position[2]&#34;: &#34;particle.position[2]&#34;
- &#34;pos[2]&#34;: &#34;particle.position[2]&#34;
- &#34;z&#34;: &#34;particle.position[2]&#34;
- &#34;species&#34;: &#34;particle.species&#34;
- &#34;spe&#34;: &#34;particle.species&#34;
- &#34;species_id&#34;: &#34;particle.species_id&#34;
- &#34;spe_id&#34;: &#34;particle.species_id&#34;
- &#34;label&#34;: &#34;particle.label&#34;
- &#34;mass&#34;: &#34;particle.mass&#34;
- &#34;radius&#34;: &#34;particle.radius&#34;
- &#34;nearest_neighbors&#34;: &#34;particle.nearest_neighbors&#34;
- &#34;neighbors&#34;: &#34;particle.nearest_neighbors&#34;
- &#34;neighbours&#34;: &#34;particle.nearest_neighbors&#34;
- &#34;voronoi_signature&#34;: &#34;particle.voronoi_signature&#34;
- &#34;signature&#34;: &#34;particle.voronoi_signature&#34;
</pre></div></div>
</div>
<p>However, any other additional particle property should be accessed using the following syntax:</p>
<p><code class="docutils literal notranslate"><span class="pre">dump('particle.&lt;property&gt;')</span></code></p>
<p>where <code class="docutils literal notranslate"><span class="pre">&lt;property&gt;</span></code> is the name of the corresponding particle property, <em>e.g.</em> <code class="docutils literal notranslate"><span class="pre">particle.kinetic_energy</span></code>, <code class="docutils literal notranslate"><span class="pre">particle.potential_energy</span></code>, etc.</p>
<div class="admonition warning">
<p class="admonition-title fa fa-exclamation-circle">Important</p>
<p>Make sure that this property is defined for <strong>all</strong> the particles before calling the <code class="docutils literal notranslate"><span class="pre">dump()</span></code> method (this is not the case here for the <code class="docutils literal notranslate"><span class="pre">mass</span></code> property, which was defined only for a single particle).</p>
</div>
<p>It is also possible to get the properties of a given <strong>subset of particles</strong>, by specifying a <code class="docutils literal notranslate"><span class="pre">subset</span></code> parameter in the form of a condition:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># Positions of the particles on the left side of the box (x &lt; 0.0)
left = traj[0].dump(&#39;pos&#39;, subset=&#39;particle.position[0] &lt; 0.0&#39;)
print(&quot;Left particles:\n&quot;, left[0:10])

# Positions of the particles on the right side of the box (x &gt; 0.0)
#  (use an alias for the x position)
right = traj[0].dump(&#39;pos&#39;, subset=&#39;x &gt; 0.0&#39;)
print(&quot;\nRight particles:\n&quot;, right[0:10])
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Left particles:
 [[-1.02062 -1.927986 0.663132]
 [-0.816276 2.062004 0.421107]
 [-0.32223 0.751391 -1.607461]
 [-1.595135 2.262852 -1.671871]
 [-2.174664 0.643808 -1.462404]
 [-0.700083 -1.346258 2.163989]
 [-2.180021 1.253083 -0.613079]
 [-1.513521 -1.463041 -1.99653]
 [-1.050631 -0.873367 0.633333]
 [-0.575498 -0.407806 -0.43532]]

Right particles:
 [[0.819926 -1.760086 0.36845]
 [0.29098 1.24579 -2.495344]
 [2.484607 0.35245 1.371003]
 [1.890651 -0.623108 -0.60892]
 [1.046703 0.46165 2.148453]
 [2.102494 2.077016 -0.048818]
 [0.162451 1.761205 0.442532]
 [1.956404 2.423274 -2.307274]
 [0.961139 2.295941 0.567796]
 [1.311121 -0.526285 -1.422479]]
</pre></div></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">set_property()</span></code>/<code class="docutils literal notranslate"><span class="pre">dump()</span></code> method also works for cell properties. However, no aliases are accepted, so a property must always come in the form <code class="docutils literal notranslate"><span class="pre">'cell.property'</span></code>:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># Volumes of the cells for all the frames in the trajectory
print(&#39;Volumes:&#39;, traj.dump(&#39;cell.volume&#39;))
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Volumes: [125.0, 125.0, 125.0, 125.0, 125.0, 125.0, 125.0, 125.0, 125.0, 125.0]
</pre></div></div>
</div>
<div class="admonition note">
<p class="admonition-title fa fa-exclamation-circle">Note</p>
<p>The <code class="docutils literal notranslate"><span class="pre">subset</span></code> parameter only works for particle properties. It will thus be ignored when dumping a cell property.</p>
</div>
</section>
<section id="Reading-additional-particle-properties-from-a-trajectory">
<h2><span class="section-number">1.5. </span>Reading additional particle properties from a trajectory<a class="headerlink" href="#Reading-additional-particle-properties-from-a-trajectory" title="Permalink to this heading"></a></h2>
<p>By default, only the species and positions of the particles are read from the input trajectory file. However, some trajectory formats can contain additional particle properties (mass, radius, etc.).</p>
<p>It is possible to read these properties from the input file using the <code class="docutils literal notranslate"><span class="pre">additional_fields</span></code> list parameter when creating an instance of <code class="docutils literal notranslate"><span class="pre">Trajectory</span></code>.</p>
<p>As a simple example, let us consider a short XYZ trajectory file called <code class="docutils literal notranslate"><span class="pre">traj_with_masses.xyz</span></code> with 2 frames and only 3 particles, as follows:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>3
columns:id,pos,mass cell:1.0,1.0,1.0
A 0.1 0.0 0.0 0.5
B 0.0 0.1 0.0 0.25
B 0.0 0.0 0.1 0.25
3
columns:id,pos,mass cell:1.0,1.0,1.0
A 0.2 0.0 0.0 0.5
B 0.0 0.2 0.0 0.25
B 0.0 0.0 0.2 0.25
</pre></div>
</div>
<p>As long as the property is specified in the header, it can be read when opening the trajectory:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># Specifying an additional field
traj = Trajectory(&#39;data/traj_with_masses.xyz&#39;,
                  additional_fields=[&#39;mass&#39;])

print(traj[0].particle[0])
print(&#39;\nMasses:\n&#39;, traj.dump(&#39;mass&#39;)) # `mass` is a valid alias
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Particle(position=[0.1 0.  0. ], species=A, label=-1, radius=0.5, nearest_neighbors=None, mass=0.5, species_id=1)

Masses:
 [array([0.5, 0.25, 0.25], dtype=object), array([0.5, 0.25, 0.25], dtype=object)]
</pre></div></div>
</div>
<p>The additional property in the input file can also take the form of a list (in this case, values must thus be separated by a comma with no white space). This is especially useful if, <em>e.g.</em> one wants to read the neighbors of the particles directly from the input file.</p>
<p>As a simple example, let us consider a short XYZ trajectory file called <code class="docutils literal notranslate"><span class="pre">traj_with_neighbors.xyz</span></code> with 2 frames and only 4 particles, as follows:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>4
columns:id,pos,radius,neighbors cell:1.0,1.0,1.0
A 0.1 0.0 0.0 0.5 1,2,3
B 0.0 0.1 0.0 0.4 0,2,3
B 0.0 0.0 0.1 0.4 0,1,3
B 0.0 0.0 0.1 0.4 0,1,2
4
columns:id,pos,radius,neighbors cell:1.0,1.0,1.0
A 0.2 0.0 0.0 0.5 1,2
B 0.0 0.2 0.0 0.4 2,3
B 0.0 0.0 0.2 0.4 0,3
B 0.0 0.0 0.1 0.4 0,2
</pre></div>
</div>
<p>We read the <code class="docutils literal notranslate"><span class="pre">neighbors</span></code> list property:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># Specifying an additional field
traj = Trajectory(&#39;data/traj_with_neighbors.xyz&#39;,
                  additional_fields=[&#39;neighbors&#39;])

print(traj[0].particle[0])
print(&#39;\nNeighbors:\n&#39;, traj.dump(&#39;neighbors&#39;)) # `neighbors` is a valid alias
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Particle(position=[0.1 0.  0. ], species=A, label=-1, radius=0.5, nearest_neighbors=[1, 2, 3], species_id=1)

Neighbors:
 [array([[1, 2, 3],
       [0, 2, 3],
       [0, 1, 3],
       [0, 1, 2]], dtype=object), array([[1, 2],
       [2, 3],
       [0, 3],
       [0, 2]], dtype=object)]
</pre></div></div>
</div>
<p>Notice, however, that the <code class="docutils literal notranslate"><span class="pre">radius</span></code> field was not read and default values are used instead:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>print(&#39;\nRadii:\n&#39;, traj.dump(&#39;radius&#39;))
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

Radii:
 [array([0.5, 0.5, 0.5, 0.5], dtype=object), array([0.5, 0.5, 0.5, 0.5], dtype=object)]
</pre></div></div>
</div>
<div class="admonition warning">
<p class="admonition-title fa fa-exclamation-circle">Important</p>
<p>Not all trajectory formats and backends support additional fields.</p>
<p>When reading reading a file, the <code class="docutils literal notranslate"><span class="pre">additional_fields</span></code> parameter may then be ignored for some formats: only positions and species will be read, in that case. The same applies when writing a trajectory, as we will see in a later section.</p>
<p>On that regard, the XYZ format is probably the most flexible, being natively supported by the code.</p>
</div>
</section>
<section id="Setting-or-modifying-a-particle-property">
<h2><span class="section-number">1.6. </span>Setting or modifying a particle property<a class="headerlink" href="#Setting-or-modifying-a-particle-property" title="Permalink to this heading"></a></h2>
<p>As a counterpart for the method <code class="docutils literal notranslate"><span class="pre">get_property()</span></code>, the method <code class="docutils literal notranslate"><span class="pre">set_property()</span></code> allows to set or change a particle property trajectory-wide, for all particles or for a specific subset.</p>
<p>The property to set can be a scalar value, in which case it will be set to all the particles in the subset:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>traj = Trajectory(&#39;data/traj_with_masses.xyz&#39;,
                  additional_fields=[&#39;mass&#39;])

# Current `mass` property
print(&quot;Masses from file:\n&quot;, traj.dump(&#39;particle.mass&#39;))

# Change it for all the particles
traj.set_property(&#39;mass&#39;, 1.0)
print(&quot;\nNew masses for all particles:\n&quot;, traj.dump(&#39;particle.mass&#39;))

# Change it for a given subset
traj.set_property(&#39;mass&#39;, 0.75, subset=&quot;species == &#39;B&#39;&quot;)
print(&quot;\nNew masses for B particles only:\n&quot;, traj.dump(&#39;particle.mass&#39;))
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Masses from file:
 [array([0.5, 0.25, 0.25], dtype=object), array([0.5, 0.25, 0.25], dtype=object)]

New masses for all particles:
 [array([1.0, 1.0, 1.0], dtype=object), array([1.0, 1.0, 1.0], dtype=object)]

New masses for B particles only:
 [array([1.0, 0.75, 0.75], dtype=object), array([1.0, 0.75, 0.75], dtype=object)]
</pre></div></div>
</div>
<p>The property can also be a <code class="docutils literal notranslate"><span class="pre">list</span></code> or a <code class="docutils literal notranslate"><span class="pre">numpy.ndarray</span></code> that will be mapped to the collection of particles (<em>i.e.</em> values are set element by element). This is especially useful if such a property property is read from another file or computed elsewhere in your code.</p>
<p>In this case, the parameter should have the right shape: same number of frames than the trajectory, and same number of particles than the considered subset:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># 2 frames, 3 particles (same as the whole trajectory)
masses = [[0.5, 0.25, 0.25],
          [0.6, 0.35, 0.35]]
traj.set_property(&#39;mass&#39;, masses)
print(&quot;New masses for all particles:\n&quot;, traj.dump(&#39;particle.mass&#39;))

# 2 frames, 2 particles
#  (because there are only B particles in the subset)
masses = [[0.23, 0.34],
          [0.56, 0.67]]
traj.set_property(&#39;mass&#39;, masses, &quot;species == &#39;B&#39;&quot;)
print(&quot;\nNew masses for B particles only:\n&quot;, traj.dump(&#39;particle.mass&#39;))
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
New masses for all particles:
 [array([0.5, 0.25, 0.25], dtype=object), array([0.6, 0.35, 0.35], dtype=object)]

New masses for B particles only:
 [array([0.5, 0.23, 0.34], dtype=object), array([0.6, 0.56, 0.67], dtype=object)]
</pre></div></div>
</div>
<p>A property can also be set for a specific frame:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[26]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>traj[0].set_property(&#39;mass&#39;, 0.75)
traj[1].set_property(&#39;mass&#39;, [0.15, 0.25, 0.35])
print(traj.dump(&#39;mass&#39;))
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[array([0.75, 0.75, 0.75], dtype=object), array([0.15, 0.25, 0.35], dtype=object)]
</pre></div></div>
</div>
<p>It can also be a new property that the particles do not have yet:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[27]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># Set a new property
energies = [[0.51, 0.43, 0.37],
            [0.55, 0.44, 0.41]]
traj.set_property(&#39;energy&#39;, energies)
print(&quot;Energies:\n&quot;, traj.dump(&#39;particle.energy&#39;))
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Energies:
 [array([0.51, 0.43, 0.37], dtype=object), array([0.55, 0.44, 0.41], dtype=object)]
</pre></div></div>
</div>
<p><em>(Notice how we specify this new property with the ``particle`` prefix since ``energy`` is not an available alias)</em></p>
<p>As mentioned in a previous section, it is <strong>crucial</strong> that the property is defined for all particles when calling the <code class="docutils literal notranslate"><span class="pre">dump</span></code> method or when applying a filter on a structural descriptor, as we will see in the notebook about <a class="reference external" href="3_descriptors.html">structural descriptors</a>.</p>
</section>
<section id="Computing-nearest-neighbors">
<h2><span class="section-number">1.7. </span>Computing nearest neighbors<a class="headerlink" href="#Computing-nearest-neighbors" title="Permalink to this heading"></a></h2>
<p><code class="docutils literal notranslate"><span class="pre">Trajectory</span></code> instances have several attributes and methods to identify nearest neighbors and determine the cutoffs delimiting the first coordination shell.</p>
<p>Nearest neighbors can be computed using the <code class="docutils literal notranslate"><span class="pre">compute_nearest_neighbors()</span></code> method which takes two optional parameters:</p>
<ol class="arabic simple">
<li><p>The <code class="docutils literal notranslate"><span class="pre">method</span></code> parameter lets us choose between several methods to identify the nearest neighbors:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;auto&quot;</span></code> : read neighbors from the trajectory file, if explicitly requested with the <code class="docutils literal notranslate"><span class="pre">additional_fields</span></code> argument, as seen in a previous section.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;fixed&quot;</span></code> : use fixed cutoffs for each pair of species in the trajectory.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;sann&quot;</span></code> : solid-angle based nearest neighbor algorithm. See the <a class="reference external" href="https://doi.org/10.1063/1.4729313">original paper</a>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;voronoi&quot;</span></code> : radical Voronoi tessellation method (uses particles’ radii). See the <a class="reference external" href="https://doi.org/10.1016/0022-3093(82)90093-X">original paper</a>.</p></li>
</ul>
</li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">cutoffs</span></code> parameter allows us to specify a list of cutoffs distances that delimit the first coordination shell. It must have the same length as the number of pairs of species <span class="math notranslate nohighlight">\((\alpha, \beta)\)</span> in the trajectory. For instance, with two species <code class="docutils literal notranslate"><span class="pre">A</span></code> and <code class="docutils literal notranslate"><span class="pre">B</span></code>, elements of this list correspond to pairs <code class="docutils literal notranslate"><span class="pre">[(A,A),</span> <span class="pre">(A,B),</span> <span class="pre">(B,A),</span> <span class="pre">(B,B)]</span></code>. These cutoffs generally correspond to the first minimum of the partial radial distribution function <span class="math notranslate nohighlight">\(g_{\alpha\beta}(r)\)</span> associated to a given
pair of species.</p></li>
</ol>
<p>Below, an example using these two parameters:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[28]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># Compute nearest neighbors
traj = Trajectory(&#39;data/kalj_N150.xyz&#39;, last=0)
traj.compute_nearest_neighbors(method=&quot;fixed&quot;,
                               cutoffs=[1.45, 1.25, 1.25, 1.075])

# Show the nearest neighbors of the first five particles
for i in range(5):
    print(traj[0].particle[i].nearest_neighbors)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[16, 37, 39, 56, 63, 69, 75, 89, 90, 96, 98, 101, 113, 123, 144]
[5, 8, 27, 43, 47, 49, 51, 54, 64, 87, 93, 97, 99, 121, 129, 138]
[21, 28, 33, 41, 45, 48, 57, 67, 68, 76, 81, 103, 115, 120, 122, 128]
[4, 17, 22, 34, 37, 46, 66, 70, 96, 98, 126, 133, 145]
[3, 10, 24, 29, 46, 51, 56, 59, 66, 70, 98, 105, 106, 133, 134]
</pre></div></div>
</div>
<p>Instance attributes <code class="docutils literal notranslate"><span class="pre">nearest_neighbors_method</span></code> and <code class="docutils literal notranslate"><span class="pre">nearest_neighbors_cutoffs</span></code> can be set instead. The cell below is equivalent to the previous one:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[29]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># Compute nearest neighbors
traj = Trajectory(&#39;data/kalj_N150.xyz&#39;, last=0)
traj.nearest_neighbors_method = &quot;fixed&quot;
traj.nearest_neighbors_cutoffs = [1.45, 1.25, 1.25, 1.075]
traj.compute_nearest_neighbors()

# Show the nearest neighbors of the first five particles
for i in range(5):
    print(traj[0].particle[i].nearest_neighbors)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[16, 37, 39, 56, 63, 69, 75, 89, 90, 96, 98, 101, 113, 123, 144]
[5, 8, 27, 43, 47, 49, 51, 54, 64, 87, 93, 97, 99, 121, 129, 138]
[21, 28, 33, 41, 45, 48, 57, 67, 68, 76, 81, 103, 115, 120, 122, 128]
[4, 17, 22, 34, 37, 46, 66, 70, 96, 98, 126, 133, 145]
[3, 10, 24, 29, 46, 51, 56, 59, 66, 70, 98, 105, 106, 133, 134]
</pre></div></div>
</div>
<div class="admonition note">
<p class="admonition-title fa fa-exclamation-circle">Note</p>
<p>For a more detailed description of each method, check out <a class="reference external" href="../descriptors/overview.html">this tutorial</a>.</p>
</div>
</section>
<section id="Visualizing-a-trajectory">
<h2><span class="section-number">1.8. </span>Visualizing a trajectory<a class="headerlink" href="#Visualizing-a-trajectory" title="Permalink to this heading"></a></h2>
<p>Simple and customizable visualization methods allow to display the trajectory frames using the <code class="docutils literal notranslate"><span class="pre">Trajectory.show()</span></code> method.</p>
<p><em>partycls</em> currently supports three visualization backends: <code class="docutils literal notranslate"><span class="pre">&quot;matplotlib&quot;</span></code>, <code class="docutils literal notranslate"><span class="pre">&quot;ovito&quot;</span></code> and <code class="docutils literal notranslate"><span class="pre">&quot;3dmol&quot;</span></code>. The specified <code class="docutils literal notranslate"><span class="pre">backend</span></code> argument of the <code class="docutils literal notranslate"><span class="pre">Trajectory.show()</span></code> method thus calls a backend-dependent function (see the <a class="reference external" href="../../source/partycls.html#module-partycls.helpers">partycls.helpers</a> submodule for more information).</p>
<div class="admonition note">
<p class="admonition-title fa fa-exclamation-circle">Note</p>
<p>If a <code class="docutils literal notranslate"><span class="pre">radius</span></code> property is defined for the particles, they will be scaled accordingly. If not, this will use a default value for all the particles.</p>
</div>
<section id="Matplotlib">
<h3><span class="section-number">1.8.1. </span>Matplotlib<a class="headerlink" href="#Matplotlib" title="Permalink to this heading"></a></h3>
<p>See the <a class="reference external" href="../../source/partycls.html#partycls.helpers.show_matplotlib">show_matplotlib()</a> function in <a class="reference external" href="../../source/partycls.html#module-partycls.helpers">partycls.helpers</a> for more information.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[30]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># Open a trajectory file
traj = Trajectory(&#39;data/kalj_N150.xyz&#39;)
# Adjust radii
traj.set_property(&#39;radius&#39;, 0.5, &quot;species == &#39;A&#39;&quot;)
traj.set_property(&#39;radius&#39;, 0.4, &quot;species == &#39;B&#39;&quot;)

# Dhow the first three frames
# (all frames are shown if `frames` is not specified)
# default coloring code uses the species
figs = traj.show(frames=[0,1,2], backend=&#39;matplotlib&#39;, show=True)
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/tutorials_notebooks_1_trajectory_70_0.png" src="../../_images/tutorials_notebooks_1_trajectory_70_0.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/tutorials_notebooks_1_trajectory_70_1.png" src="../../_images/tutorials_notebooks_1_trajectory_70_1.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/tutorials_notebooks_1_trajectory_70_2.png" src="../../_images/tutorials_notebooks_1_trajectory_70_2.png" />
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">Trajectory</span></code> class being iterable, one can also show a specific frame by calling <code class="docutils literal notranslate"><span class="pre">show()</span></code> on an element of the trajectory:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[31]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># Show the 5-th frame, change the view, use custom colors
fig = traj[4].show(backend=&#39;matplotlib&#39;, view=&#39;back&#39;,
                   palette=[&#39;y&#39;, &#39;g&#39;], show=True)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/tutorials_notebooks_1_trajectory_72_0.png" src="../../_images/tutorials_notebooks_1_trajectory_72_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[32]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># Color particles according to an arbitrary *discrete* particle property
# (for the example, we randomly assign labels to the particles)
traj[0].set_property(&#39;label&#39;, 0)
p = [0,15,28,37,41,56,63,72,88,90,104,113,125,137,142]
for pi in p:
    traj[0].particle[pi].label = 1
fig = traj[0].show(color=&#39;label&#39;, palette=[&#39;b&#39;, &#39;r&#39;], show=True)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/tutorials_notebooks_1_trajectory_73_0.png" src="../../_images/tutorials_notebooks_1_trajectory_73_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[33]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>from numpy.random import normal

# Color particles according to an arbitrary *continuous* particle property
# (for the example, we randomly assign a random float property to the particles)
rn = [normal() for i in range(150)]
traj[0].set_property(&#39;random&#39;, rn)
fig = traj[0].show(color=&#39;random&#39;, cmap=&#39;viridis&#39;, show=True)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/tutorials_notebooks_1_trajectory_74_0.png" src="../../_images/tutorials_notebooks_1_trajectory_74_0.png" />
</div>
</div>
</section>
<section id="Ovito">
<h3><span class="section-number">1.8.2. </span>Ovito<a class="headerlink" href="#Ovito" title="Permalink to this heading"></a></h3>
<p>See the <a class="reference external" href="../../source/partycls.html#partycls.helpers.show_ovito">show_ovito()</a> function in <a class="reference external" href="../../source/partycls.html#module-partycls.helpers">partycls.helpers</a> for more information.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[34]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>from partycls.trajectory import Trajectory

# Open a trajectory file
traj = Trajectory(&#39;data/kalj_N150.xyz&#39;)
# Adjust radii
traj.set_property(&#39;radius&#39;, 0.5, &quot;species == &#39;A&#39;&quot;)
traj.set_property(&#39;radius&#39;, 0.4, &quot;species == &#39;B&#39;&quot;)

# Show the first frame
traj[0].show(backend=&#39;ovito&#39;)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[34]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="../../_images/tutorials_notebooks_1_trajectory_76_0.png" src="../../_images/tutorials_notebooks_1_trajectory_76_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[35]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># Color particles according to an arbitrary *discrete* particle property
# (for the example, we randomly assign labels to the particles)
traj[0].set_property(&#39;label&#39;, 0)
p = [0,15,28,37,41,56,63,72,88,90,104,113,125,137,142]
for pi in p:
    traj[0].particle[pi].label = 1

# /!\ Colors must be in RGB format
ovito_colors = [(0.1,0.25,0.9), (0.8,0.15,0.2)]

# Show the first frame
traj[0].show(color=&#39;label&#39;, backend=&#39;ovito&#39;, palette=ovito_colors, view=&#39;bottom&#39;)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[35]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="../../_images/tutorials_notebooks_1_trajectory_77_0.png" src="../../_images/tutorials_notebooks_1_trajectory_77_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[36]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>from numpy.random import normal

# color particles according to an arbitrary *continuous* particle property
# (for the example, we randomly assign a random float property to the particles)
rn = [normal() for i in range(150)]
traj[0].set_property(&#39;random&#39;, rn)
traj[0].show(color=&#39;random&#39;, backend=&#39;ovito&#39;, cmap=&#39;plasma&#39;)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[36]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="../../_images/tutorials_notebooks_1_trajectory_78_0.png" src="../../_images/tutorials_notebooks_1_trajectory_78_0.png" />
</div>
</div>
</section>
<section id="py3Dmol">
<h3><span class="section-number">1.8.3. </span>py3Dmol<a class="headerlink" href="#py3Dmol" title="Permalink to this heading"></a></h3>
<p>See the <a class="reference external" href="../../source/partycls.html#partycls.helpers.show_3dmol">show_3dmol()</a> function in <a class="reference external" href="../../source/partycls.html#module-partycls.helpers">partycls.helpers</a> for more information.</p>
<div class="admonition warning">
<p class="admonition-title fa fa-exclamation-circle">Warning</p>
<p>This backend works well with small systems, but tends to get pretty slow with larger systems.</p>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[37]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># Open a trajectory file
traj = Trajectory(&#39;data/dislocation.xyz&#39;)

# Show the first frame
# Default coloring code uses the species
view = traj[0].show(backend=&#39;3dmol&#39;)
view.show()
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<div id="3dmolviewer_16668961614203215"  style="position: relative; width: 640px; height: 480px">
        <p id="3dmolwarning_16668961614203215" style="background-color:#ffcccc;color:black">You appear to be running in JupyterLab (or JavaScript failed to load for some other reason).  You need to install the 3dmol extension: <br>
        <tt>jupyter labextension install jupyterlab_3dmol</tt></p>
        </div>
<script>

var loadScriptAsync = function(uri){
  return new Promise((resolve, reject) => {
    var tag = document.createElement('script');
    tag.src = uri;
    tag.async = true;
    tag.onload = () => {
      resolve();
    };
  var firstScriptTag = document.getElementsByTagName('script')[0];
  firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
});
};

if(typeof $3Dmolpromise === 'undefined') {
$3Dmolpromise = null;
  $3Dmolpromise = loadScriptAsync('https://cdn.jsdelivr.net/npm/3dmol@latest/build/3Dmol-min.min.js');
}

var viewer_16668961614203215 = null;
var warn = document.getElementById("3dmolwarning_16668961614203215");
if(warn) {
    warn.parentNode.removeChild(warn);
}
$3Dmolpromise.then(function() {
viewer_16668961614203215 = $3Dmol.createViewer($("#3dmolviewer_16668961614203215"),{backgroundColor:"white"});
viewer_16668961614203215.zoomTo();
    viewer_16668961614203215.setBackgroundColor("white");
    viewer_16668961614203215.addSphere({"center": {"x": -0.8558697759106223, "y": -0.9649468530962736, "z": -0.8547344729254289}, "radius": 0.5, "color": "#50514f"});
    viewer_16668961614203215.addSphere({"center": {"x": -0.8602721518763825, "y": -0.9648737276151803, "z": 0.07381692809686763}, "radius": 0.5, "color": "#50514f"});
    viewer_16668961614203215.addSphere({"center": {"x": -0.9693498589008231, "y": -0.8932724529261576, "z": 1.0746978044385056}, "radius": 0.5, "color": "#50514f"});
    viewer_16668961614203215.addSphere({"center": {"x": -0.931003060892466, "y": 0.0906421084323454, "z": -0.9347219931645108}, "radius": 0.5, "color": "#50514f"});
    viewer_16668961614203215.addSphere({"center": {"x": -0.41118204395823243, "y": 0.5020889814008229, "z": 0.5287314044336557}, "radius": 0.5, "color": "#50514f"});
    viewer_16668961614203215.addSphere({"center": {"x": -0.870177462481879, "y": 0.05551840265243458, "z": 1.0242209579401511}, "radius": 0.5, "color": "#50514f"});
    viewer_16668961614203215.addSphere({"center": {"x": -0.3582105172550749, "y": 0.5497848691530429, "z": -0.48345960648419306}, "radius": 0.5, "color": "#50514f"});
    viewer_16668961614203215.addSphere({"center": {"x": -0.8794647092376797, "y": 1.0792744188157424, "z": 0.1473039076094796}, "radius": 0.5, "color": "#50514f"});
    viewer_16668961614203215.addSphere({"center": {"x": -0.9189083416280903, "y": 1.0481397970631017, "z": 1.112564032055733}, "radius": 0.5, "color": "#50514f"});
    viewer_16668961614203215.addSphere({"center": {"x": 0.05301680314927515, "y": -0.94742785918522, "z": -0.8549464443794755}, "radius": 0.5, "color": "#50514f"});
    viewer_16668961614203215.addSphere({"center": {"x": 0.035559859853506105, "y": -0.9248481259320641, "z": 0.03006044024402194}, "radius": 0.5, "color": "#50514f"});
    viewer_16668961614203215.addSphere({"center": {"x": 0.14301474812636608, "y": -0.941787303853777, "z": 1.0613264970991187}, "radius": 0.5, "color": "#50514f"});
    viewer_16668961614203215.addSphere({"center": {"x": 0.11391750305127941, "y": 0.08678734589613311, "z": -0.8876543353736666}, "radius": 0.5, "color": "#50514f"});
    viewer_16668961614203215.addSphere({"center": {"x": 0.07491040207825587, "y": 0.035269921885601914, "z": 0.1414707503195194}, "radius": 0.5, "color": "#50514f"});
    viewer_16668961614203215.addSphere({"center": {"x": 0.108104060365299, "y": 0.048350815115693196, "z": 1.073786852813738}, "radius": 0.5, "color": "#50514f"});
    viewer_16668961614203215.addSphere({"center": {"x": 0.12185492860547649, "y": 1.1107175735832546, "z": -0.9703669149025768}, "radius": 0.5, "color": "#50514f"});
    viewer_16668961614203215.addSphere({"center": {"x": 0.13132859040703243, "y": 1.0514940202870073, "z": 0.07630951602117632}, "radius": 0.5, "color": "#50514f"});
    viewer_16668961614203215.addSphere({"center": {"x": 0.07016638117571933, "y": 1.1342226557565658, "z": 1.0634306782399423}, "radius": 0.5, "color": "#50514f"});
    viewer_16668961614203215.addSphere({"center": {"x": 1.0925840817949808, "y": -0.9847811179100662, "z": -0.9043616750186302}, "radius": 0.5, "color": "#50514f"});
    viewer_16668961614203215.addSphere({"center": {"x": 1.0132734377820958, "y": -0.9508336531796028, "z": 0.0390254098717825}, "radius": 0.5, "color": "#50514f"});
    viewer_16668961614203215.addSphere({"center": {"x": 1.0412750572714158, "y": -0.9101020887287774, "z": 1.0242910359044375}, "radius": 0.5, "color": "#50514f"});
    viewer_16668961614203215.addSphere({"center": {"x": 1.084215236443952, "y": 0.10752536526967194, "z": -0.9200580460168513}, "radius": 0.5, "color": "#50514f"});
    viewer_16668961614203215.addSphere({"center": {"x": 1.10988070397366, "y": 0.09913011275147743, "z": 0.048234301846316066}, "radius": 0.5, "color": "#50514f"});
    viewer_16668961614203215.addSphere({"center": {"x": 1.0270014439199402, "y": 0.07538931497658617, "z": 1.0565087011152035}, "radius": 0.5, "color": "#50514f"});
    viewer_16668961614203215.addSphere({"center": {"x": 1.0513188750026883, "y": 1.1457146007582395, "z": -0.9853513566331166}, "radius": 0.5, "color": "#50514f"});
    viewer_16668961614203215.addSphere({"center": {"x": 1.1375962924508913, "y": 1.085456784971159, "z": 0.021702114843469338}, "radius": 0.5, "color": "#50514f"});
    viewer_16668961614203215.addSphere({"center": {"x": 1.0361659497474067, "y": 1.1025921110714816, "z": 1.1065822071929692}, "radius": 0.5, "color": "#50514f"});
    viewer_16668961614203215.addBox({"center": {"x": 0.0, "y": 0.0, "z": 0.0}, "dimensions": {"w": 3.0, "h": 3.0, "d": 3.0}, "wireframe": true, "color": "#000000"});
viewer_16668961614203215.render();
});
</script></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[38]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># Color particles according to an arbitrary *discrete* particle property
# (for the example, we randomly assign labels to the particles)
traj[0].set_property(&#39;label&#39;, 0)
p = [0,5,11,16,20]
for pi in p:
    traj[0].particle[pi].label = 1
view = traj[0].show(backend=&#39;3dmol&#39;, color=&#39;label&#39;, palette=[&#39;blue&#39;, &#39;red&#39;])
view.show()
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<div id="3dmolviewer_166689616142977"  style="position: relative; width: 640px; height: 480px">
        <p id="3dmolwarning_166689616142977" style="background-color:#ffcccc;color:black">You appear to be running in JupyterLab (or JavaScript failed to load for some other reason).  You need to install the 3dmol extension: <br>
        <tt>jupyter labextension install jupyterlab_3dmol</tt></p>
        </div>
<script>

var loadScriptAsync = function(uri){
  return new Promise((resolve, reject) => {
    var tag = document.createElement('script');
    tag.src = uri;
    tag.async = true;
    tag.onload = () => {
      resolve();
    };
  var firstScriptTag = document.getElementsByTagName('script')[0];
  firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
});
};

if(typeof $3Dmolpromise === 'undefined') {
$3Dmolpromise = null;
  $3Dmolpromise = loadScriptAsync('https://cdn.jsdelivr.net/npm/3dmol@latest/build/3Dmol-min.min.js');
}

var viewer_166689616142977 = null;
var warn = document.getElementById("3dmolwarning_166689616142977");
if(warn) {
    warn.parentNode.removeChild(warn);
}
$3Dmolpromise.then(function() {
viewer_166689616142977 = $3Dmol.createViewer($("#3dmolviewer_166689616142977"),{backgroundColor:"white"});
viewer_166689616142977.zoomTo();
    viewer_166689616142977.setBackgroundColor("white");
    viewer_166689616142977.addSphere({"center": {"x": -0.8558697759106223, "y": -0.9649468530962736, "z": -0.8547344729254289}, "radius": 0.5, "color": "red"});
    viewer_166689616142977.addSphere({"center": {"x": -0.8602721518763825, "y": -0.9648737276151803, "z": 0.07381692809686763}, "radius": 0.5, "color": "blue"});
    viewer_166689616142977.addSphere({"center": {"x": -0.9693498589008231, "y": -0.8932724529261576, "z": 1.0746978044385056}, "radius": 0.5, "color": "blue"});
    viewer_166689616142977.addSphere({"center": {"x": -0.931003060892466, "y": 0.0906421084323454, "z": -0.9347219931645108}, "radius": 0.5, "color": "blue"});
    viewer_166689616142977.addSphere({"center": {"x": -0.41118204395823243, "y": 0.5020889814008229, "z": 0.5287314044336557}, "radius": 0.5, "color": "blue"});
    viewer_166689616142977.addSphere({"center": {"x": -0.870177462481879, "y": 0.05551840265243458, "z": 1.0242209579401511}, "radius": 0.5, "color": "red"});
    viewer_166689616142977.addSphere({"center": {"x": -0.3582105172550749, "y": 0.5497848691530429, "z": -0.48345960648419306}, "radius": 0.5, "color": "blue"});
    viewer_166689616142977.addSphere({"center": {"x": -0.8794647092376797, "y": 1.0792744188157424, "z": 0.1473039076094796}, "radius": 0.5, "color": "blue"});
    viewer_166689616142977.addSphere({"center": {"x": -0.9189083416280903, "y": 1.0481397970631017, "z": 1.112564032055733}, "radius": 0.5, "color": "blue"});
    viewer_166689616142977.addSphere({"center": {"x": 0.05301680314927515, "y": -0.94742785918522, "z": -0.8549464443794755}, "radius": 0.5, "color": "blue"});
    viewer_166689616142977.addSphere({"center": {"x": 0.035559859853506105, "y": -0.9248481259320641, "z": 0.03006044024402194}, "radius": 0.5, "color": "blue"});
    viewer_166689616142977.addSphere({"center": {"x": 0.14301474812636608, "y": -0.941787303853777, "z": 1.0613264970991187}, "radius": 0.5, "color": "red"});
    viewer_166689616142977.addSphere({"center": {"x": 0.11391750305127941, "y": 0.08678734589613311, "z": -0.8876543353736666}, "radius": 0.5, "color": "blue"});
    viewer_166689616142977.addSphere({"center": {"x": 0.07491040207825587, "y": 0.035269921885601914, "z": 0.1414707503195194}, "radius": 0.5, "color": "blue"});
    viewer_166689616142977.addSphere({"center": {"x": 0.108104060365299, "y": 0.048350815115693196, "z": 1.073786852813738}, "radius": 0.5, "color": "blue"});
    viewer_166689616142977.addSphere({"center": {"x": 0.12185492860547649, "y": 1.1107175735832546, "z": -0.9703669149025768}, "radius": 0.5, "color": "blue"});
    viewer_166689616142977.addSphere({"center": {"x": 0.13132859040703243, "y": 1.0514940202870073, "z": 0.07630951602117632}, "radius": 0.5, "color": "red"});
    viewer_166689616142977.addSphere({"center": {"x": 0.07016638117571933, "y": 1.1342226557565658, "z": 1.0634306782399423}, "radius": 0.5, "color": "blue"});
    viewer_166689616142977.addSphere({"center": {"x": 1.0925840817949808, "y": -0.9847811179100662, "z": -0.9043616750186302}, "radius": 0.5, "color": "blue"});
    viewer_166689616142977.addSphere({"center": {"x": 1.0132734377820958, "y": -0.9508336531796028, "z": 0.0390254098717825}, "radius": 0.5, "color": "blue"});
    viewer_166689616142977.addSphere({"center": {"x": 1.0412750572714158, "y": -0.9101020887287774, "z": 1.0242910359044375}, "radius": 0.5, "color": "red"});
    viewer_166689616142977.addSphere({"center": {"x": 1.084215236443952, "y": 0.10752536526967194, "z": -0.9200580460168513}, "radius": 0.5, "color": "blue"});
    viewer_166689616142977.addSphere({"center": {"x": 1.10988070397366, "y": 0.09913011275147743, "z": 0.048234301846316066}, "radius": 0.5, "color": "blue"});
    viewer_166689616142977.addSphere({"center": {"x": 1.0270014439199402, "y": 0.07538931497658617, "z": 1.0565087011152035}, "radius": 0.5, "color": "blue"});
    viewer_166689616142977.addSphere({"center": {"x": 1.0513188750026883, "y": 1.1457146007582395, "z": -0.9853513566331166}, "radius": 0.5, "color": "blue"});
    viewer_166689616142977.addSphere({"center": {"x": 1.1375962924508913, "y": 1.085456784971159, "z": 0.021702114843469338}, "radius": 0.5, "color": "blue"});
    viewer_166689616142977.addSphere({"center": {"x": 1.0361659497474067, "y": 1.1025921110714816, "z": 1.1065822071929692}, "radius": 0.5, "color": "blue"});
    viewer_166689616142977.addBox({"center": {"x": 0.0, "y": 0.0, "z": 0.0}, "dimensions": {"w": 3.0, "h": 3.0, "d": 3.0}, "wireframe": true, "color": "#000000"});
viewer_166689616142977.render();
});
</script></div>
</div>
</section>
</section>
<section id="Writing-a-trajectory">
<h2><span class="section-number">1.9. </span>Writing a trajectory<a class="headerlink" href="#Writing-a-trajectory" title="Permalink to this heading"></a></h2>
<p>The class <code class="docutils literal notranslate"><span class="pre">Trajectory</span></code> can also write a trajectory files with the <code class="docutils literal notranslate"><span class="pre">write()</span></code> method.</p>
<p>Once the input trajectory has been loaded at the creation of a <code class="docutils literal notranslate"><span class="pre">Trajectory</span></code> object, any link with the original file is <strong>broken</strong>: changing the current instance of <code class="docutils literal notranslate"><span class="pre">Trajectory</span></code> will have no effect on the original file.</p>
<p>Writing a new trajectory file from the current instance can then be useful for many reasons. For example, convert from a format to another:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[39]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># Open XYZ file
traj = Trajectory(&#39;data/traj_with_masses.xyz&#39;)

# Write the trajectory in RUMD format (as a new file)
traj.write(&#39;data/traj_with_masses.xyz.gz&#39;, fmt=&#39;rumd&#39;)
</pre></div>
</div>
</div>
<p>Or write a trajectory file with additional fields that were not present in the original file:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[40]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># Open XYZ file
traj = Trajectory(&#39;data/traj_with_masses.xyz&#39;, additional_fields=[&#39;mass&#39;])

# Set custom values for radii of the particles
traj.set_property(&#39;radius&#39;, 0.5, &quot;species == &#39;A&#39;&quot;)
traj.set_property(&#39;radius&#39;, 0.4, &quot;species == &#39;B&#39;&quot;)

# Write a new file with both masses and radii
traj.write(&#39;data/traj_with_masses_and_radii.xyz&#39;, fmt=&#39;xyz&#39;, additional_fields=[&#39;mass&#39;, &#39;radius&#39;])
</pre></div>
</div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../../tutorials.html" class="btn btn-neutral float-left" title="Tutorials" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="2_workflow.html" class="btn btn-neutral float-right" title="2. Setting and running a workflow" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Joris Paret.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>